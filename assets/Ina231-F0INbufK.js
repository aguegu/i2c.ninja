import{_ as R,I as j,a as G,b as M,e as W,c as X,f as E,g as J,h as K,i as q,s as H,d as Q}from"./utils-Dax9hThb.js";import"./lodash-B4X47Vf9.js";import{r as s,U as $,z as Y,P as B,V as Z,A as ee,C as w,D as e,O as te,B as x,J as t,F as l,G as k,K as I,M as ae}from"./index-CPfc8qSv.js";import{_ as ne}from"./Space-BaYJkXh7.js";const se={style:{position:"relative",height:"60vh"}},le={name:"DeviceIna231"},me=Object.assign(le,{setup(ue){const i=s(!1),d=s(null),c=s(null),v=s(null),f=s(null),h=s(100),g=s(null),_=s("40"),T=$("emitter");let y=null,n=null,b=Date.now();const{transmit:u,connect:V}=$("adapter"),S=async()=>{try{({mvShunt:d.value,maShunt:c.value,mvBus:v.value,mwPower:f.value}=await y.measure());const a=Date.now();n.data.datasets[0].data.push({x:a,y:d.value}),n.data.datasets[1].data.push({x:a,y:c.value}),n.data.datasets[2].data.push({x:a,y:v.value}),n.data.datasets[3].data.push({x:a,y:f.value}),a>b+50&&(b=a,B().then(()=>{n.options.scales.x.min=H(new Date,{minutes:1});const o=n.data.datasets[0].data.findLastIndex(r=>r.x<n.options.scales.x.min);n.data.datasets[0].data.splice(0,o),n.update()})),i.value&&(await Q(h.value),S())}catch(a){console.log(a),i.value=!1}},C=async()=>{await V(),await u("AT"),await u("AT");const a=await u("AT+SC");if(!Array.from(a).includes(parseInt(_.value,16)))throw T.emit("message",{type:"error",data:{message:"Not Found"}}),new Error(`V53L at adrress 0x${_.value} NOT Found`);y=new j({transmit:u},_.value),await u(`AT+TX=${_.value}008000`),await u(`AT+TX=${_.value}004727`),await y.init(),i.value=!0,S()};return Y(()=>{B().then(()=>{n=new Z(g.value,{type:"line",data:{datasets:[{label:"mvShunt",fill:!1,data:[],yAxisID:"mvShunt"},{label:"maShunt",fill:!1,data:[],yAxisID:"maShunt"},{label:"mvBus",fill:!1,data:[],yAxisID:"mvBus"},{label:"mwPower",fill:!1,data:[],yAxisID:"mwPower"}]},options:{spanGaps:!0,responsive:!0,maintainAspectRatio:!1,parsing:!1,normalized:!0,animations:{numbers:{properties:["x"],type:"number",from:void 0}},scales:{x:{type:"time",ticks:{stepSize:5},time:{unit:"second"},title:{display:!0,text:"Date"}},mvShunt:{title:{display:!0,text:"mV"}},maShunt:{title:{display:!0,text:"mA"}},mvBus:{title:{display:!0,text:"mV"},position:"right"},mwPower:{title:{display:!0,text:"mW"},position:"right"}}}})})}),ee(()=>{n.destroy()}),(a,o)=>{const r=G,P=M,N=W,F=X,U=E,A=ae,z=ne,m=J,p=K,L=q,O=te;return x(),w(O,null,{header:e(()=>[t(P,null,{default:e(()=>[t(r,null,{default:e(()=>[l("Device")]),_:1}),t(r,null,{default:e(()=>[l("V53L")]),_:1})]),_:1})]),"header-extra":e(()=>[t(z,null,{default:e(()=>[t(U,{"label-placement":"left",inline:""},{default:e(()=>[t(F,{label:`${a.$t("adapter.Interval")} (ms)`,style:{width:"300px"}},{default:e(()=>[t(N,{value:h.value,"onUpdate:value":o[0]||(o[0]=D=>h.value=D),step:100,min:0,max:1e3},null,8,["value"])]),_:1},8,["label"])]),_:1}),t(R),i.value?(x(),w(A,{key:0,onClick:o[1]||(o[1]=D=>{i.value=!1}),type:"warning"},{default:e(()=>[l(k(a.$t("adapter.Stop")),1)]),_:1})):(x(),w(A,{key:1,onClick:C,type:"primary"},{default:e(()=>[l(k(a.$t("adapter.Start")),1)]),_:1}))]),_:1})]),default:e(()=>[t(L,{"x-gap":"12",cols:4},{default:e(()=>[t(p,null,{default:e(()=>[t(m,{label:"mvShunt",value:d.value},{suffix:e(()=>[l("mV")]),_:1},8,["value"])]),_:1}),t(p,null,{default:e(()=>[t(m,{label:"maShunt",value:c.value},{suffix:e(()=>[l("mA")]),_:1},8,["value"])]),_:1}),t(p,null,{default:e(()=>[t(m,{label:"mvBus",value:v.value},{suffix:e(()=>[l("mV")]),_:1},8,["value"])]),_:1}),t(p,null,{default:e(()=>[t(m,{label:"mwPower",value:f.value},{suffix:e(()=>[l("mW")]),_:1},8,["value"])]),_:1})]),_:1}),I("div",se,[I("canvas",{ref_key:"chartRef",ref:g},null,512)])]),_:1})}}});export{me as default};
