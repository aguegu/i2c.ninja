import{f as L,s as D,_ as R,I as M,a as W,b as X,d as E,c as G,e as J,g as K,h as q,i as H,j as Q}from"./utils-7f4c410d.js";import"./lodash-819bf5e9.js";import{r as s,T,z as Y,P as k,U as Z,A as ee,B as x,C as y,D as e,O as te,J as t,F as l,K as I,M as ae}from"./index-44b1c0b3.js";import{_ as ne}from"./Space-2d16d2df.js";const se={style:{position:"relative",height:"60vh"}},le={name:"DeviceBh1750"},re=Object.assign(le,{setup(ue){const i=s(!1),p=s(null),d=s(null),f=s(null),v=s(null),h=s(100),g=s(null),_=s("40"),V=T("emitter");let w=null,a=null,b=Date.now();const{transmit:u,connect:$}=T("adapter"),S=async()=>{try{({mvShunt:p.value,maShunt:d.value,mvBus:f.value,mwPower:v.value}=await w.measure());const n=Date.now();a.data.datasets[0].data.push({x:n,y:p.value}),a.data.datasets[1].data.push({x:n,y:d.value}),a.data.datasets[2].data.push({x:n,y:f.value}),a.data.datasets[3].data.push({x:n,y:v.value}),n>b+50&&(b=n,k().then(()=>{a.options.scales.x.min=D(new Date,{minutes:1});const o=a.data.datasets[0].data.findLastIndex(m=>m.x<a.options.scales.x.min);a.data.datasets[0].data.splice(0,o),a.update()})),i.value&&(await Q(h.value),S())}catch(n){console.log(n),i.value=!1}},C=async()=>{await $(),await u("AT"),await u("AT");const n=await u("AT+SC");if(!Array.from(n).includes(parseInt(_.value,16)))throw V.emit("message",{type:"error",data:{message:"Not Found"}}),new Error(`V53L at adrress 0x${_.value} NOT Found`);w=new M({transmit:u},_.value),await u(`AT+TX=${_.value}008000`),await u(`AT+TX=${_.value}004727`),await w.init(),i.value=!0,S()};return Y(()=>{k().then(()=>{a=new Z(g.value,{type:"line",data:{datasets:[{label:"mvShunt",fill:!1,data:[],yAxisID:"mvShunt"},{label:"maShunt",fill:!1,data:[],yAxisID:"maShunt"},{label:"mvBus",fill:!1,data:[],yAxisID:"mvBus"},{label:"mwPower",fill:!1,data:[],yAxisID:"mwPower"}]},options:{spanGaps:!0,responsive:!0,maintainAspectRatio:!1,parsing:!1,normalized:!0,animations:{numbers:{properties:["x"],type:"number",from:void 0}},scales:{x:{type:"time",min:L(D(new Date,{minutes:1})),ticks:{stepSize:5},time:{unit:"second"},title:{display:!0,text:"Date"}},mvShunt:{title:{display:!0,text:"mV"}},maShunt:{title:{display:!0,text:"mA"}},mvBus:{title:{display:!0,text:"mV"},position:"right"},mwPower:{title:{display:!0,text:"mW"},position:"right"}}}})})}),ee(()=>{a.destroy()}),(n,o)=>{const m=W,P=X,N=E,F=G,O=J,A=ae,U=ne,r=K,c=q,j=H,z=te;return x(),y(z,null,{header:e(()=>[t(P,null,{default:e(()=>[t(m,null,{default:e(()=>[l("Device")]),_:1}),t(m,null,{default:e(()=>[l("V53L")]),_:1})]),_:1})]),"header-extra":e(()=>[t(U,null,{default:e(()=>[t(O,{"label-placement":"left",inline:""},{default:e(()=>[t(F,{label:"Interval (ms):",style:{width:"300px"}},{default:e(()=>[t(N,{value:h.value,"onUpdate:value":o[0]||(o[0]=B=>h.value=B),step:100,min:0,max:1e3},null,8,["value"])]),_:1})]),_:1}),t(R),i.value?(x(),y(A,{key:0,onClick:o[1]||(o[1]=B=>{i.value=!1}),type:"warning"},{default:e(()=>[l("Stop")]),_:1})):(x(),y(A,{key:1,onClick:C,type:"primary"},{default:e(()=>[l("Start")]),_:1}))]),_:1})]),default:e(()=>[t(j,{"x-gap":"12",cols:4},{default:e(()=>[t(c,null,{default:e(()=>[t(r,{label:"mvShunt",value:p.value},{suffix:e(()=>[l("mV")]),_:1},8,["value"])]),_:1}),t(c,null,{default:e(()=>[t(r,{label:"maShunt",value:d.value},{suffix:e(()=>[l("mA")]),_:1},8,["value"])]),_:1}),t(c,null,{default:e(()=>[t(r,{label:"mvBus",value:f.value},{suffix:e(()=>[l("mV")]),_:1},8,["value"])]),_:1}),t(c,null,{default:e(()=>[t(r,{label:"mwPower",value:v.value},{suffix:e(()=>[l("mW")]),_:1},8,["value"])]),_:1})]),_:1}),I("div",se,[I("canvas",{ref_key:"chartRef",ref:g},null,512)])]),_:1})}}});export{re as default};
