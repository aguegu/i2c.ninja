import{B as v,_ as P,a as X,b as Y,c as Z,e as q,f as Q,g as W,h as ee,i as te,m as ne,s as ae,d as se}from"./utils-CXPfh8Vn.js";import"./lodash-Dr83-R63.js";import{F as oe,f as le}from"./FileSaver.min-DMznZ3XV.js";import{T as ue,r as l,U as A,z as ie,P as C,V as re,A as _e,R as ce,C as g,D as t,O as pe,B as c,J as n,F as u,G as i,X as me,Y as de,$ as S,Z as fe,K as T,M as ve}from"./index-BK02bb7p.js";import{_ as ge,a as ye}from"./RadioGroup-DxUOFP0O.js";import{_ as he}from"./Space-Dg0Pa17L.js";const be={style:{position:"relative",height:"60vh"}},we={name:"DeviceBh1750"},Te=Object.assign(we,{setup($e){const{t:w}=ue({useScope:"global"}),r=l(!1),p=l(null),y=l(200),D=l(69),F=l(v.modes.continuousHighResMode),$=l(null),_=l(v.addresses[0]),I=A("emitter"),h=[];let m=null,s=null,x=Date.now();const{transmit:d,connect:R}=A("adapter"),k=async()=>{try{p.value=await m.measure();const e=Date.now();s.data.datasets[0].data.push({x:e,y:p.value}),h.push([le(e,{fractionDigits:3}),p.value]),e>x+50&&(x=e,C().then(()=>{s.options.scales.x.min=ae(new Date,{minutes:1});const a=s.data.datasets[0].data.findLastIndex(f=>f.x<s.options.scales.x.min);s.data.datasets[0].data.splice(0,a),s.update()})),r.value&&(await se(y.value),k())}catch(e){console.log(e),r.value=!1}},M=async()=>{await R(),await d("AT"),await d("AT");const e=await d("AT+SC");if(!Array.from(e).includes(parseInt(_.value,16)))throw I.emit("message",{type:"error",data:{message:"Not Found"}}),new Error(`BH1750 at adrress 0x${_.value} NOT Found`);m=new v({transmit:d},_.value),await m.init(F.value),await m.setMeasureTime(D.value),r.value=!0,h.length=0,k()};ie(()=>{C().then(()=>{s=new re($.value,{type:"line",data:{datasets:[{label:w("measurement.Illuminance"),fill:!1,data:[]}]},options:{spanGaps:!0,responsive:!0,maintainAspectRatio:!1,parsing:!1,normalized:!0,animations:{numbers:{properties:["x"],type:"number",from:void 0}},scales:{x:{type:"time",ticks:{stepSize:5},time:{unit:"second"}},y:{title:{display:!0,text:w("measurement.lx")}}}}})})});const N=()=>{const e=new Blob([`timestamp,Illuminance
`,h.map(a=>a.join(",")).join(`
`)],{type:"text/csv;charset=utf-8"});oe.saveAs(e,`BH1750_${new Date().toISOString()}.csv`)};return _e(()=>{s.destroy()}),(e,a)=>{const f=X,U=Y,j=ye,H=ge,B=Z,O=q,V=Q,b=ve,z=ce("svg-icon"),E=he,G=W,L=ee,J=te,K=pe;return c(),g(K,null,{header:t(()=>[n(U,null,{default:t(()=>[n(f,null,{default:t(()=>[u(i(e.$t("header.Ambient"))+i(e.$t("adapter.Sensor")),1)]),_:1}),n(f,null,{default:t(()=>[u("BH1750")]),_:1})]),_:1})]),"header-extra":t(()=>[n(E,null,{default:t(()=>[n(V,{"label-placement":"left",inline:""},{default:t(()=>[n(B,{label:e.$t("adapter.Address")},{default:t(()=>[n(H,{value:_.value,"onUpdate:value":a[0]||(a[0]=o=>_.value=o)},{default:t(()=>[(c(!0),me(fe,null,de(S(v).addresses,o=>(c(),g(j,{key:o,value:o},{default:t(()=>[u("0x"+i(o),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),n(B,{label:`${e.$t("adapter.Interval")} (ms)`,style:{width:"300px"}},{default:t(()=>[n(O,{value:y.value,"onUpdate:value":a[1]||(a[1]=o=>y.value=o),step:100,min:0,max:1e3},null,8,["value"])]),_:1},8,["label"])]),_:1}),n(P),r.value?(c(),g(b,{key:0,onClick:a[2]||(a[2]=o=>{r.value=!1}),type:"warning"},{default:t(()=>[u(i(e.$t("adapter.Stop")),1)]),_:1})):(c(),g(b,{key:1,onClick:M,type:"primary"},{default:t(()=>[u(i(e.$t("adapter.Start")),1)]),_:1})),n(b,{onClick:N},{icon:t(()=>[n(z,{type:"mdi",path:S(ne)},null,8,["path"])]),_:1})]),_:1})]),default:t(()=>[n(J,{"x-gap":"12",cols:2},{default:t(()=>[n(L,null,{default:t(()=>[n(G,{label:e.$t("measurement.Illuminance"),value:p.value},{suffix:t(()=>[u(i(e.$t("measurement.lx")),1)]),_:1},8,["label","value"])]),_:1})]),_:1}),T("div",be,[T("canvas",{ref_key:"chartRef",ref:$},null,512)])]),_:1})}}});export{Te as default};
