import{m as _,l as $,k as C,f as X,s as k,_ as z,a as V,b as W,d as G,c as J,e as K,g as q,h as H,i as Q,j as Y}from"./utils-4a2a637f.js";import{_ as Z}from"./lodash-cd78795a.js";import{r as u,T as I,z as ee,P as D,U as te,A as ae,B as v,C as h,D as e,O as se,J as a,F as d,K as M,M as ne}from"./index-b4fcf539.js";import{_ as le}from"./Space-22a2d323.js";class ie{constructor(t,s="5A"){this.adapter=t,this.address=s,this.addressW=_(parseInt(this.address,16)<<1),this.addressR=_((parseInt(this.address,16)<<1)+1)}async readCelsius(t){const l=(await this.adapter.transmit(`AT+TR=${this.address}${t}03`)).readUInt16LE();return l>=32768?Promise.resolve(null):Promise.resolve(Z.round(l*.02-273.15,2))}async measure(){const t=await this.readCelsius("06"),s=await this.readCelsius("07");return Promise.resolve({ambient:t,target:s})}async readEmissivity(){return this.adapter.transmit(`AT+TR=${this.address}2403`).then(t=>t.readUInt16LE()/65535)}async writeEmissivity(t){const s=_($([parseInt(this.addressW,16),36,0,0],7,0));await this.adapter.transmit(`AT+TX=${this.address}240000${s}`),await C(20);const l=parseInt(65535*t),r=[parseInt(this.addressW,16),36,l&255,l>>8],p=_($(r,7,0));await this.adapter.transmit(`AT+TX=${this.address}${r.slice(1).map(c=>_(c)).join("")}${p}`),await C(20)}}const oe={style:{position:"relative",height:"60vh"}},re={name:"DeviceMlx90614"},pe=Object.assign(re,{setup(R){const t=u(!1),s=u(null),l=u(null),r=u(500),p=u(null),c=u("5A"),U=I("emitter");let x=null,n=null,y=Date.now();const{transmit:m,connect:B}=I("adapter"),g=async()=>{try{({ambient:s.value,target:l.value}=await x.measure());const i=Date.now();n.data.datasets[0].data.push({x:i,y:s.value}),n.data.datasets[1].data.push({x:i,y:l.value}),i>y+50&&(y=i,D().then(()=>{n.options.scales.x.min=k(new Date,{minutes:1});const o=n.data.datasets[0].data.findLastIndex(f=>f.x<n.options.scales.x.min);n.data.datasets[0].data.splice(0,o),n.data.datasets[1].data.splice(0,o),n.update()})),t.value&&(await Y(r.value),g())}catch(i){console.log(i),t.value=!1}},E=async()=>{await B(),await m("AT"),await m("AT");const i=await m("AT+SC");if(!Array.from(i).includes(parseInt(c.value,16)))throw U.emit("message",{type:"error",data:{message:"Not Found"}}),new Error(`MLX90614 at adrress 0x${c.value} NOT Found`);x=new ie({transmit:m},c.value),t.value=!0,g()};return ee(()=>{D().then(()=>{n=new te(p.value,{type:"line",data:{datasets:[{label:"Ambient",fill:!1,data:[]},{label:"Target",fill:!1,data:[]}]},options:{spanGaps:!0,responsive:!0,maintainAspectRatio:!1,parsing:!1,normalized:!0,animations:{numbers:{properties:["x"],type:"number",from:void 0}},scales:{x:{type:"time",min:X(k(new Date,{minutes:1})),ticks:{stepSize:5},time:{unit:"second"},title:{display:!0,text:"Date"}},y:{title:{display:!0,text:"Celsius"}}}}})})}),ae(()=>{n.destroy()}),(i,o)=>{const f=V,L=W,N=G,S=J,j=K,w=ne,F=le,b=q,T=H,O=Q,P=se;return v(),h(P,null,{header:e(()=>[a(L,null,{default:e(()=>[a(f,null,{default:e(()=>[d("Device")]),_:1}),a(f,null,{default:e(()=>[d("MLX90614")]),_:1})]),_:1})]),"header-extra":e(()=>[a(F,null,{default:e(()=>[a(j,{"label-placement":"left",inline:""},{default:e(()=>[a(S,{label:"Interval (ms):",style:{width:"300px"}},{default:e(()=>[a(N,{value:r.value,"onUpdate:value":o[0]||(o[0]=A=>r.value=A),step:100,min:0,max:1e3},null,8,["value"])]),_:1})]),_:1}),a(z),t.value?(v(),h(w,{key:0,onClick:o[1]||(o[1]=A=>{t.value=!1}),type:"warning"},{default:e(()=>[d("Stop")]),_:1})):(v(),h(w,{key:1,onClick:E,type:"primary"},{default:e(()=>[d("Start")]),_:1}))]),_:1})]),default:e(()=>[a(O,{"x-gap":"12",cols:2},{default:e(()=>[a(T,null,{default:e(()=>[a(b,{label:"Ambient",value:s.value},{suffix:e(()=>[d("Celsius")]),_:1},8,["value"])]),_:1}),a(T,null,{default:e(()=>[a(b,{label:"Target",value:l.value},{suffix:e(()=>[d("Celsius")]),_:1},8,["value"])]),_:1})]),_:1}),M("div",oe,[M("canvas",{ref_key:"chartRef",ref:p},null,512)])]),_:1})}}});export{pe as default};
