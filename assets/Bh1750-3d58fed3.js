import{B as d,f as H,s as b,_ as E,a as G,b as L,c as J,e as K,g as P,h as X,i as Y,j as Z,k as q}from"./utils-0ad49ed3.js";import"./lodash-506d9b3f.js";import{r as o,T as k,z as Q,P as B,U as W,A as ee,B as r,C as f,D as e,O as te,J as t,F as u,V as ne,X as ae,Z as se,Y as oe,K as T,M as le,G as ue}from"./index-d86c7646.js";import{_ as _e,a as ie}from"./RadioGroup-9e7d606a.js";import{_ as re}from"./Space-bed4b1c5.js";const ce={style:{position:"relative",height:"60vh"}},pe={name:"DeviceBh1750"},ye=Object.assign(pe,{setup(me){const _=o(!1),v=o(null),g=o(500),D=o(69),A=o(d.modes.continuousHighResMode),x=o(null),i=o(d.addresses[0]),C=k("emitter");let c=null,n=null;const{transmit:p,connect:I}=k("adapter"),y=async()=>{try{v.value=await c.measure();const l=Date.now();n.data.datasets[0].data.push({x:l,y:v.value}),n.options.scales.x.min=b(new Date,{minutes:1});const a=n.data.datasets[0].data.findLastIndex(m=>m.x<n.options.scales.x.min);n.data.datasets[0].data.splice(0,a),await B(),n.update(),_.value&&(await q(g.value),y())}catch(l){console.log(l),_.value=!1}},S=async()=>{await I(),await p("AT"),await p("AT");const l=await p("AT+SC");if(!Array.from(l).includes(parseInt(i.value,16)))throw C.emit("message",{type:"error",data:{message:"Not Found"}}),new Error(`BH1750 at adrress 0x${i.value} NOT Found`);c=new d({transmit:p},i.value),await c.init(A.value),await c.setMeasureTime(D.value),_.value=!0,y()};return Q(()=>{B().then(()=>{n=new W(x.value,{type:"line",data:{datasets:[{label:"Illuminance",fill:!1,data:[]}]},options:{spanGaps:!0,responsive:!0,maintainAspectRatio:!1,parsing:!1,normalized:!0,animations:{numbers:{properties:["x"],type:"number",from:void 0}},scales:{x:{type:"time",min:H(b(new Date,{minutes:1})),ticks:{stepSize:5},time:{unit:"second"},title:{display:!0,text:"Date"}},y:{title:{display:!0,text:"lx"}}}}})})}),ee(()=>{n.destroy()}),(l,a)=>{const m=G,$=L,F=ie,N=_e,w=J,M=K,O=P,h=le,R=re,U=X,V=Y,j=Z,z=te;return r(),f(z,null,{header:e(()=>[t($,null,{default:e(()=>[t(m,null,{default:e(()=>[u("Device")]),_:1}),t(m,null,{default:e(()=>[u("BH1750")]),_:1})]),_:1})]),"header-extra":e(()=>[t(R,null,{default:e(()=>[t(O,{"label-placement":"left",inline:""},{default:e(()=>[t(w,{label:"Address:"},{default:e(()=>[t(N,{value:i.value,"onUpdate:value":a[0]||(a[0]=s=>i.value=s)},{default:e(()=>[(r(!0),ne(oe,null,ae(se(d).addresses,s=>(r(),f(F,{key:s,value:s},{default:e(()=>[u("0x"+ue(s),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(w,{label:"Interval (ms):",style:{width:"300px"}},{default:e(()=>[t(M,{value:g.value,"onUpdate:value":a[1]||(a[1]=s=>g.value=s),step:100,min:100,max:1e3},null,8,["value"])]),_:1})]),_:1}),t(E),_.value?(r(),f(h,{key:0,onClick:a[2]||(a[2]=s=>{_.value=!1}),type:"warning"},{default:e(()=>[u("Stop")]),_:1})):(r(),f(h,{key:1,onClick:S,type:"primary"},{default:e(()=>[u("Start")]),_:1}))]),_:1})]),default:e(()=>[t(j,{"x-gap":"12",cols:2},{default:e(()=>[t(V,null,{default:e(()=>[t(U,{label:"Illuminance",value:v.value},{suffix:e(()=>[u("lx")]),_:1},8,["value"])]),_:1})]),_:1}),T("div",ce,[T("canvas",{ref_key:"chartRef",ref:x},null,512)])]),_:1})}}});export{ye as default};
