import{_ as J,S as K,d as T,a as X,b as Y,c as Z,e as q,f as H,g as Q,h as W,i as ee,m as ae,s as te}from"./utils-CXPfh8Vn.js";import"./lodash-Dr83-R63.js";import{F as ne,f as se}from"./FileSaver.min-DMznZ3XV.js";import{T as le,r as u,U as P,z as oe,P as D,V as re,A as ue,R as ie,C as w,D as a,O as pe,B as g,J as t,F as o,G as i,X as _e,Y as ce,Z as me,$ as de,K as F,M as fe}from"./index-BK02bb7p.js";import{_ as ve,a as ge}from"./RadioGroup-DxUOFP0O.js";import{_ as ye}from"./Space-Dg0Pa17L.js";const be={style:{position:"relative",height:"60vh"}},he={name:"DeviceSpl06"},Te=Object.assign(he,{setup(we){const{t:y}=le({useScope:"global"}),r=u(!1),_=u(null),c=u(null),m=u(500),$=u(null),p=u("76"),B=P("emitter"),b=[];let d=null,s=null,x=Date.now();const{transmit:f,connect:I}=P("adapter"),S=async()=>{try{({pressure:c.value,temperature:_.value}=await d.measure());const e=Date.now();s.data.datasets[0].data.push({x:e,y:_.value}),s.data.datasets[1].data.push({x:e,y:c.value}),b.push([se(e,{fractionDigits:3}),_.value,c.value]),e>x+50&&(x=e,D().then(()=>{s.options.scales.x.min=te(e,{minutes:1});const n=s.data.datasets[0].data.findLastIndex(v=>v.x<s.options.scales.x.min);s.data.datasets[0].data.splice(0,n),s.data.datasets[1].data.splice(0,n),s.update()})),r.value&&(await T(m.value),S())}catch(e){console.log(e),r.value=!1}},j=async()=>{await I(),await f("AT"),await f("AT");const e=await f("AT+SC");if(!Array.from(e).includes(parseInt(p.value,16)))throw B.emit("message",{type:"error",data:{message:"Not Found"}}),new Error(`SPL06 at adrress 0x${p.value} NOT Found`);d=new K({transmit:f},p.value),await d.init(),await d.measure(),await T(m.value),r.value=!0,b.length=0,S()};oe(()=>{D().then(()=>{s=new re($.value,{type:"line",data:{datasets:[{label:y("measurement.Temperature"),fill:!1,data:[],yAxisID:"yT"},{label:y("measurement.AirPressure"),fill:!1,data:[],yAxisID:"yP"}]},options:{spanGaps:!0,responsive:!0,maintainAspectRatio:!1,parsing:!1,normalized:!0,animations:{numbers:{properties:["x"],type:"number",from:void 0}},scales:{x:{type:"time",ticks:{major:{enabled:!0},stepSize:5},time:{unit:"second"}},yT:{title:{display:!0,text:"°C"},ticks:{stepSize:1,precision:1}},yP:{title:{display:!0,text:y("measurement.Pascal")},ticks:{stepSize:10,precision:0},position:"right",grid:{drawOnChartArea:!1}}}}})})});const z=()=>{const e=new Blob([`timestamp,temperature,pressure
`,b.map(n=>n.join(",")).join(`
`)],{type:"text/csv;charset=utf-8"});ne.saveAs(e,`SPL06_${new Date().toISOString()}.csv`)};return ue(()=>{s.destroy()}),(e,n)=>{const v=X,L=Y,N=ge,O=ve,k=Z,R=q,U=H,h=fe,V=ie("svg-icon"),E=ye,A=Q,C=W,M=ee,G=pe;return g(),w(G,null,{header:a(()=>[t(L,null,{default:a(()=>[t(v,null,{default:a(()=>[o(i(e.$t("header.Ambient"))+i(e.$t("adapter.Sensor")),1)]),_:1}),t(v,null,{default:a(()=>[o("SPL06")]),_:1})]),_:1})]),"header-extra":a(()=>[t(E,null,{default:a(()=>[t(U,{"label-placement":"left",inline:""},{default:a(()=>[t(k,{label:e.$t("adapter.Address")},{default:a(()=>[t(O,{value:p.value,"onUpdate:value":n[0]||(n[0]=l=>p.value=l),disabled:r.value},{default:a(()=>[(g(),_e(me,null,ce(["76","77"],l=>t(N,{key:l,value:l},{default:a(()=>[o("0x"+i(l),1)]),_:2},1032,["value"])),64))]),_:1},8,["value","disabled"])]),_:1},8,["label"]),t(k,{label:`${e.$t("adapter.Interval")} (ms)`,style:{width:"300px"}},{default:a(()=>[t(R,{value:m.value,"onUpdate:value":n[1]||(n[1]=l=>m.value=l),step:100,min:400,max:5e3},null,8,["value"])]),_:1},8,["label"])]),_:1}),t(J),r.value?(g(),w(h,{key:0,onClick:n[2]||(n[2]=l=>{r.value=!1}),type:"warning"},{default:a(()=>[o(i(e.$t("adapter.Stop")),1)]),_:1})):(g(),w(h,{key:1,onClick:j,type:"primary"},{default:a(()=>[o(i(e.$t("adapter.Start")),1)]),_:1})),t(h,{onClick:z},{icon:a(()=>[t(V,{type:"mdi",path:de(ae)},null,8,["path"])]),_:1})]),_:1})]),default:a(()=>[t(M,{"x-gap":"12",cols:2},{default:a(()=>[t(C,null,{default:a(()=>[t(A,{label:e.$t("measurement.Temperature"),value:_.value},{suffix:a(()=>[o("°C")]),_:1},8,["label","value"])]),_:1}),t(C,null,{default:a(()=>[t(A,{label:e.$t("measurement.AirPressure"),value:c.value},{suffix:a(()=>[o(i(e.$t("measurement.Pascal")),1)]),_:1},8,["label","value"])]),_:1})]),_:1}),F("div",be,[F("canvas",{ref_key:"chartRef",ref:$},null,512)])]),_:1})}}});export{Te as default};
