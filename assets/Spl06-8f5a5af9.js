import{f as V,s as A,_ as M,S as R,a as E,b as G,c as J,d as K,e as X,g as Y,h as q,i as H,j as Q}from"./utils-7f4c410d.js";import"./lodash-819bf5e9.js";import{r as i,T,z as W,P as C,U as Z,A as ee,B as c,C as g,D as e,O as te,J as t,F as o,V as ae,X as ne,Y as se,K as D,M as le,G as oe}from"./index-44b1c0b3.js";import{_ as ue,a as ie}from"./RadioGroup-1653886f.js";import{_ as re}from"./Space-2d16d2df.js";const _e={style:{position:"relative",height:"60vh"}},pe={name:"DeviceSpl06"},ye=Object.assign(pe,{setup(ce){const u=i(!1),d=i(null),m=i(null),f=i(500),y=i(null),r=i("76"),P=T("emitter");let v=null,a=null,x=Date.now();const{transmit:_,connect:$}=T("adapter"),b=async()=>{try{({pressure:m.value,temperature:d.value}=await v.measure());const n=Date.now();a.data.datasets[0].data.push({x:n,y:d.value}),a.data.datasets[1].data.push({x:n,y:m.value}),n>x+50&&(x=n,C().then(()=>{a.options.scales.x.min=A(n,{minutes:1});const s=a.data.datasets[0].data.findLastIndex(p=>p.x<a.options.scales.x.min);a.data.datasets[0].data.splice(0,s),a.data.datasets[1].data.splice(0,s),a.update()})),u.value&&(await Q(f.value),b())}catch(n){console.log(n),u.value=!1}},B=async()=>{await $(),await _("AT"),await _("AT");const n=await _("AT+SC");if(!Array.from(n).includes(parseInt(r.value,16)))throw P.emit("message",{type:"error",data:{message:"Not Found"}}),new Error(`SPL06 at adrress 0x${r.value} NOT Found`);v=new R({transmit:_},r.value),await v.init(),u.value=!0,b()};return W(()=>{console.log("onMounted"),C().then(()=>{a=new Z(y.value,{type:"line",data:{datasets:[{label:"Temperature",fill:!1,data:[],yAxisID:"yT"},{label:"Pressure",fill:!1,data:[],yAxisID:"yP"}]},options:{spanGaps:!0,responsive:!0,maintainAspectRatio:!1,parsing:!1,normalized:!0,animations:{numbers:{properties:["x"],type:"number",from:void 0}},scales:{x:{type:"time",min:V(A(new Date,{minutes:1})),ticks:{major:{enabled:!0},stepSize:5},time:{unit:"second"},title:{display:!0,text:"Date"}},yT:{title:{display:!0,text:"Celsius"},ticks:{stepSize:1,precision:1}},yP:{title:{display:!0,text:"Pascal"},ticks:{stepSize:10,precision:0},position:"right",grid:{drawOnChartArea:!1}}}}})})}),ee(()=>{a.destroy()}),(n,s)=>{const p=E,I=G,z=ie,F=ue,w=J,N=K,O=X,h=le,U=re,k=Y,S=q,j=H,L=te;return c(),g(L,null,{header:e(()=>[t(I,null,{default:e(()=>[t(p,null,{default:e(()=>[o("Device")]),_:1}),t(p,null,{default:e(()=>[o("SPL06")]),_:1})]),_:1})]),"header-extra":e(()=>[t(U,null,{default:e(()=>[t(O,{"label-placement":"left",inline:""},{default:e(()=>[t(w,{label:"Address:"},{default:e(()=>[t(F,{value:r.value,"onUpdate:value":s[0]||(s[0]=l=>r.value=l),disabled:u.value},{default:e(()=>[(c(),ae(se,null,ne(["76","77"],l=>t(z,{key:l,value:l},{default:e(()=>[o("0x"+oe(l),1)]),_:2},1032,["value"])),64))]),_:1},8,["value","disabled"])]),_:1}),t(w,{label:"Interval (ms):",style:{width:"300px"}},{default:e(()=>[t(N,{value:f.value,"onUpdate:value":s[1]||(s[1]=l=>f.value=l),step:100,min:400,max:5e3},null,8,["value"])]),_:1})]),_:1}),t(M),u.value?(c(),g(h,{key:0,onClick:s[2]||(s[2]=l=>{u.value=!1}),type:"warning"},{default:e(()=>[o("Stop")]),_:1})):(c(),g(h,{key:1,onClick:B,type:"primary"},{default:e(()=>[o("Start")]),_:1}))]),_:1})]),default:e(()=>[t(j,{"x-gap":"12",cols:2},{default:e(()=>[t(S,null,{default:e(()=>[t(k,{label:"Temperature",value:d.value},{suffix:e(()=>[o("Â°C")]),_:1},8,["value"])]),_:1}),t(S,null,{default:e(()=>[t(k,{label:"Air Pressure",value:m.value},{suffix:e(()=>[o("Pascal")]),_:1},8,["value"])]),_:1})]),_:1}),D("div",_e,[D("canvas",{ref_key:"chartRef",ref:y},null,512)])]),_:1})}}});export{ye as default};
